<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
</head>
<body>

    <h1>User Profile</h1>
    <div id="profileInfo">
        Loading profile...
    </div>

    <script>
        // Function to get a cookie by name
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        // Function to fetch and display the user's profile
        function fetchProfile() {
            const jwtToken = getCookie('jwt');

            if (!jwtToken) {
                document.getElementById('profileInfo').innerText = 'User is not authenticated';
                return;
            }

            fetch('http://localhost:9000/auth/user', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${jwtToken}`, ////////// here
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.username) {
                    // Display the user profile information
                    document.getElementById('profileInfo').innerHTML = `
                        <p><strong>Username:</strong> ${data.username}</p>
                        <p><strong>Email:</strong> ${data.email || "N/A"}</p>
                        <p><strong>Is 42 User:</strong> ${data.is_42_user ? "Yes" : "No"}</p>
                    `;
                } else {
                    document.getElementById('profileInfo').innerText = 'Failed to load profile data';
                }
            })
            .catch(error => {
                console.error("Error fetching profile:", error);
                document.getElementById('profileInfo').innerText = 'Error loading profile';
            });
        }

        // Load profile data when the page loads
        window.onload = fetchProfile;
    </script>

</body>
</html>